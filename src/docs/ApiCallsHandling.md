## React Query + API Setvice

### Setup

```typescript
// lib/queryClient.ts
import { QueryClient, QueryFunctionContext } from '@tanstack/react-query';
import { apiService } from '@/services/api';

const defaultQueryFn = async ({ queryKey }: QueryFunctionContext) => {
  // queryKey –≤ React Query - —Ü–µ –∑–∞–≤–∂–¥–∏ –º–∞—Å–∏–≤.
  // –î–æ–º–æ–≤–∏–º–æ—Å—å –ø—Ä–æ –∫–æ–Ω–≤–µ–Ω—Ü—ñ—é: [URL, Params]
  const [url, params] = queryKey as [string, Record<string, unknown> | undefined];

  return apiService.get(url, params);
};

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      queryFn: defaultQueryFn,
      retry: 1,
      refetchOnWindowFocus: false,
      staleTime: 5 * 60 * 1000, // –î–∞–Ω—ñ –≤–≤–∞–∂–∞—é—Ç—å—Å—è —Å–≤—ñ–∂–∏–º–∏ 5 —Ö–≤
    },
  },
});
```

### Component setup

```typescript
import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from '@/lib/queryClient';

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <YourApp />
    </QueryClientProvider>
  );
}
```

### Use Get Data

```typescript
import { useQuery } from '@tanstack/react-query';

const UserProfile = ({ userId }: { userId: number }) => {
  const { data, isPending, isError } = useQuery<User>({
    // –¶–µ–π –º–∞—Å–∏–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ª–µ—Ç–∏—Ç—å —É defaultQueryFn -> apiService.get('/users', { id: userId })
    queryKey: ['/users', { id: userId }],

    // enabled: false - —è–∫—â–æ —Ö–æ—á–µ—à –Ω–µ —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç, –ø–æ–∫–∏ –Ω–µ–º–∞—î ID (–∞–Ω–∞–ª–æ–≥ if –≤ useEffect)
    enabled: !!userId,
  });

  if (isPending) return <div>Loading...</div>;
  if (isError) return <div>Error...</div>;

  return <div>{data.name}</div>;
};
```

### Use Mutations

```typescript
// features/users/useCreateUser.ts
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { apiService } from '@/api/service';
import { User } from '@/types';

export const useCreateUser = () => {
  const queryClient = useQueryClient();
  const queryKey = ['/users'];

  return useMutation({
    // 1. –í–ª–∞—Å–Ω–µ –∑–∞–ø–∏—Ç
    mutationFn: (newUser: Omit<User, 'id'>) => apiService.post<User>('/users', newUser),

    // 2. –û–ü–¢–ò–ú–Ü–°–¢–ò–ß–ù–ï –û–ù–û–í–õ–ï–ù–ù–Ø (—Å–ø—Ä–∞—Ü—å–æ–≤—É—î –º–∏—Ç—Ç—î–≤–æ)
    onMutate: async (newUser) => {
      // –ê. –°–∫–∞—Å–æ–≤—É—î–º–æ –±—É–¥—å-—è–∫—ñ –∞–∫—Ç–∏–≤–Ω—ñ refetch, —â–æ–± –≤–æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–ª–∏ –Ω–∞—à—ñ –∑–º—ñ–Ω–∏
      await queryClient.cancelQueries({ queryKey });

      // –ë. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∞–Ω (snapshot)
      const previousUsers = queryClient.getQueryData<User[]>(queryKey);

      // –í. –û–Ω–æ–≤–ª—é—î–º–æ –∫–µ—à –≤—Ä—É—á–Ω—É
      queryClient.setQueryData<User[]>(queryKey, (old = []) => [
        ...old,
        // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π –æ–±'—î–∫—Ç. ID –º–æ–∂–Ω–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –∞–±–æ temp-1
        { id: Math.random(), ...newUser, isOptimistic: true },
      ]);

      // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–æ–∂–ª–∏–≤–æ–≥–æ –≤—ñ–¥–∫–∞—Ç—É
      return { previousUsers };
    },

    // 3. –Ø–∫—â–æ —Å—Ç–∞–ª–∞—Å—å –ø–æ–º–∏–ª–∫–∞ ‚Äî –≤—ñ–¥–∫–æ—á—É—î–º–æ –∑–º—ñ–Ω–∏
    onError: (err, newUser, context) => {
      if (context?.previousUsers) {
        queryClient.setQueryData(queryKey, context.previousUsers);
      }
    },

    // 4. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (—É—Å–ø—ñ—Ö –∞–±–æ –ø–æ–º–∏–ª–∫–∞)
    onSettled: () => {
      // –¢—É—Ç –º–∏ –≤–∏—Ä—ñ—à—É—î–º–æ: —Ä–æ–±–∏—Ç–∏ GET —á–∏ –Ω—ñ?
      // Best Practice: –ó—Ä–æ–±–∏—Ç–∏, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π ID –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.
      queryClient.invalidateQueries({ queryKey });
    },
  });
};
```

### Domain Layer

–ù–∞–≤—ñ—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è useSWR –∞–±–æ useQuery –Ω–∞–ø—Ä—è–º—É –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (View Layer) ‚Äî —Ü–µ –Ω–µ —ñ–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤. –°—Ç–≤–æ—Ä—é–π Custom Hooks (Domain Layer). –¶–µ —ñ–Ω–∫–∞–ø—Å—É–ª—é—î –∫–ª—é—á—ñ –∫–µ—à—É–≤–∞–Ω–Ω—è.

```typescript
import useSWR from 'swr'; // –∞–±–æ useQuery

export const useUser = (id: number) => {
  const { data, error, isLoading, mutate } = useSWR<User>(['/users', { id }]);

  return {
    user: data,
    isError: !!error,
    isLoading,
    refreshUser: mutate, // –∞–±—Å—Ç—Ä–∞–≥—É—î–º–æ –º–µ—Ç–æ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
  };
};

const UserProfile = ({ id }) => {
  // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–∑–∞–≥–∞–ª—ñ –Ω–µ –∑–Ω–∞—î –ø—Ä–æ URL, API —á–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É SWR/ReactQuery
  const { user, isLoading } = useUser(id);

  if (isLoading) return <Loader />;
  return <div>{user?.name}</div>;
};
```

### Pooling

```typescript
useQuery({
  queryKey: ['/process-status'],
  queryFn: () => apiService.get(`/export/${id}`),
  refetchInterval: 2000,
  // –ü—Ä–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∫–ª–∞–¥–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞
  refetchIntervalInBackground: true,
  refetchInterval: (query) => {
    const currentStatus = query.state.data?.status;

    if (currentStatus === 'completed' || currentStatus === 'failed') {
      return false; // –°–¢–û–ü
    }

    return 1000; // –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ –∫–æ–∂–Ω—É 1000–º—Å
  },
});
```

## –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö (Selectors)

–í Redux —Ç–∏ —Ä–æ–±–∏–≤: `API -> Reducer (–∑–º—ñ–Ω—é—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É) -> Store -> Component`.
–í React Query —Ç–∏ —Ä–æ–±–∏—à: `API -> Cache (–∑–±–µ—Ä—ñ–≥–∞—î —è–∫ —î) -> Select (—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î –¥–ª—è UI) -> Component`.

–£ `useQuery` —î –æ–ø—Ü—ñ—è `select`. –¶–µ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –ø—Ä–∏–π–º–∞—î "—Å–∏—Ä—ñ" –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É (–¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ, —Å–ø–∏—Å–∫—É —Ç–æ—â–æ).

**–í–∞–∂–ª–∏–≤–æ:** –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–º–µ–º–æ—ñ–∑–∞—Ü—ñ—é**. –í–æ–Ω–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –∑–Ω–æ–≤—É, —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –∑–º—ñ–Ω–∏–ª–∏—Å—è –¥–∞–Ω—ñ (`data`) –∞–±–æ –∑–º—ñ–Ω–∏–ª–∞—Å—å —Å–∞–º–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

#### –ü—Ä–∏–∫–ª–∞–¥: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –¢–∞–±–ª–∏—Ü—ñ

–£—è–≤–∏, —â–æ –±–µ–∫–µ–Ω–¥ –≤—ñ–¥–¥–∞—î —Å–∫–ª–∞–¥–Ω–∏–π JSON, –∞ —Ç–æ–±—ñ –¥–ª—è `<Table />` –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–ª–æ—Å–∫–∏–π –º–∞—Å–∏–≤.

```typescript
interface RawUser {
  id: number;
  attributes: {
    firstName: string;
    lastName: string;
    metadata: { lastLogin: string };
  };
}

interface TableRow {
  id: number;
  fullName: string;
  lastSeen: string;
}

const useUsersTable = () => {
  return useQuery({
    queryKey: ['users'],
    queryFn: apiService.getUsers,

    // ‚ö°Ô∏è –û–°–¨ –¢–í–Ü–ô "REDUCER" / "SELECTOR"
    select: (data: RawUser[]): TableRow[] => {
      return data.map((user) => ({
        id: user.id,
        fullName: `${user.attributes.firstName} ${user.attributes.lastName}`,
        lastSeen: new Date(user.attributes.metadata.lastLogin).toLocaleDateString(),
      }));
    },
  });
};
```

–¢–µ–ø–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç—Ä–∏–º–∞—î –≤–∂–µ **–≥–æ—Ç–æ–≤–∏–π** –º–∞—Å–∏–≤ `TableRow[]`. –Ø–∫—â–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è –∑ —ñ–Ω—à–∏—Ö –ø—Ä–∏—á–∏–Ω ‚Äî `select` –Ω–µ –±—É–¥–µ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –º–∞—Å–∏–≤ –∑–∞–Ω–æ–≤–æ (—Å—Ç–∞–±—ñ–ª—å–Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è).

---

## –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è —Ç–∞ —Å–ø–∏—Å–∫–∏

### –ê. –ó–≤–∏—á–∞–π–Ω–∞ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è

–¢–æ–±—ñ –Ω–µ —Ç—Ä–µ–±–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–∞–Ω—ñ –≤—Å—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –≤ —Å—Ç–æ—Ä—ñ. –¢–∏ –∑–±–µ—Ä—ñ–≥–∞—î—à –≤ –∫–µ—à—ñ –∫–æ–∂–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –æ–∫—Ä–µ–º–æ –ø—ñ–¥ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º –∫–ª—é—á–µ–º `['users', page]`.

–©–æ–± —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ "–±–ª–∏–º–∞–≤" –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ (Loading...), –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `placeholderData`.

```typescript
const [page, setPage] = useState(1);

const { data } = useQuery({
  queryKey: ['users', page],
  queryFn: () => fetchUsers(page),
  // –ó–∞–ª–∏—à–∞—î –¥–∞–Ω—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ, –ø–æ–∫–∏ –≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è –Ω–æ–≤–∞
  placeholderData: keepPreviousData,
});
```

### –ë. Infinite Scroll (Load More)

–î–ª—è —Ü—å–æ–≥–æ —î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Ö—É–∫ **`useInfiniteQuery`**. –í—ñ–Ω —Å–∞–º –∫–µ—Ä—É—î –º–∞—Å–∏–≤–æ–º —Å—Ç–æ—Ä—ñ–Ω–æ–∫. –¢–æ–±—ñ –Ω–µ —Ç—Ä–µ–±–∞ –ø–∏—Å–∞—Ç–∏ —Ä–µ–¥—é—Å–µ—Ä –¥–ª—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—ó.

```typescript
const { data, fetchNextPage } = useInfiniteQuery({
  queryKey: ['users', 'infinite'],
  queryFn: ({ pageParam = 1 }) => fetchUsers(pageParam),
  getNextPageParam: (lastPage) => lastPage.nextPage ?? undefined,
});

// data.pages ‚Äî —Ü–µ –º–∞—Å–∏–≤ –º–∞—Å–∏–≤—ñ–≤.
// –©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä—É:
const allUsers = data?.pages.flatMap((page) => page.users) ?? [];
```

---

## –¢–æ–¥—ñ –Ω–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω Zustand?

–û—Å—å —Ç—É—Ç –¥—ñ–∞–≥—Ä–∞–º–∞ –ø–æ–∫–∞–∑—É—î —Ä—ñ–∑–Ω–∏—Ü—é.

–¢–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à **Zustand** (–∞–±–æ Context API) –Ω–µ –¥–ª—è –¥–∞–Ω–∏—Ö, –∞ –¥–ª—è **–∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø–∏—Ç—É**.

–Ü–¥–µ–∞–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:

1. **Zustand:** –ó–±–µ—Ä—ñ–≥–∞—î —Ñ—ñ–ª—å—Ç—Ä–∏, —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è, –Ω–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –≤—ñ–¥–∫—Ä–∏—Ç—ñ –º–æ–¥–∞–ª–∫–∏.
2. **React Query:** –°–ª—É—Ö–∞—î –∑–º—ñ–Ω–∏ –≤ Zustand —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ñ–µ—Ç—á–∏—Ç—å/–∫–µ—à—É—î/—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î –¥–∞–Ω—ñ.

**–ü—Ä–∏–∫–ª–∞–¥ –∑–≤'—è–∑–∫–∏ (Best Practice):**

```typescript
// 1. Zustand Store: –¢—ñ–ª—å–∫–∏ –ª–µ–≥–∫–æ–≤–∞–≥–æ–≤—ñ UI –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
const useFiltersStore = create((set) => ({
  search: '',
  status: 'active',
  setSearch: (search) => set({ search }),
}));

// 2. React Query: –†–µ–∞–≥—É—î –Ω–∞ –∑–º—ñ–Ω–∏
const useFilteredUsers = () => {
  // –î—ñ—Å—Ç–∞—î–º–æ —Ñ—ñ–ª—å—Ç—Ä–∏
  const { search, status } = useFiltersStore();

  return useQuery({
    // –ö–ª—é—á –∑–º—ñ–Ω–∏–≤—Å—è -> React Query —Ä–æ–±–∏—Ç—å –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç
    queryKey: ['users', { search, status }],
    queryFn: () => apiService.getUsers({ search, status }),

    // –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î–º–æ –ø—ñ–¥ —Ç–∞–±–ª–∏—Ü—é
    select: (data) => data.map((u) => ({ ...u, key: u.id })),
  });
};
```

### –í–∏—Å–Ω–æ–≤–æ–∫

1. **–î–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö (Table, View Models):** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –æ–ø—Ü—ñ—é `select` –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `useQuery`. –¶–µ —Ç–≤—ñ–π –Ω–æ–≤–∏–π "selector/reducer".
2. **–î–ª—è "—Å–∫–ª–µ—é–≤–∞–Ω–Ω—è" —Å–ø–∏—Å–∫—ñ–≤:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `useInfiniteQuery`.
3. **–î–ª—è —Å—Ç–∞–Ω—É UI (–§—ñ–ª—å—Ç—Ä–∏, –¢–∞–±–∏, Pagination Index):** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π **Zustand** –∞–±–æ URL (search params).

–ù–µ –¥—É–±–ª—é–π –¥–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å–µ—Ä–≤–µ—Ä–∞ –≤ Zustand. –¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó ("Two sources of truth"), –≤—ñ–¥ —è–∫–æ—ó –º–∏ –Ω–∞–º–∞–≥–∞—î–º–æ—Å—è –≤—Ç–µ–∫—Ç–∏.

## –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ Next.js (App Router) –∑ TanStack Query

Server Component (app/users/page.tsx)

```typescript
import { HydrationBoundary, QueryClient, dehydrate } from '@tanstack/react-query';
import { getUsers } from '@/actions/getUsers';
import UserList from './user-list'; // –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

export default async function UsersPage() {
  const queryClient = new QueryClient();

  // 1. Prefetch –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.
  // –ó–∞—É–≤–∞–∂: –º–∏ –≤–∏–∫–ª–∏–∫–∞—î–º–æ —Å–µ—Ä–≤–µ—Ä–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é –Ω–∞–ø—Ä—è–º—É, –±–µ–∑ HTTP fetch
  await queryClient.prefetchQuery({
    queryKey: ['users'],
    queryFn: () => getUsers(),
  });

  // 2. Dehydrate state
  // –ú–∏ –ø–µ—Ä–µ–¥–∞—î–º–æ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∏–π —Å—Ç–∞–Ω —É HydrationBoundary
  return (
    <HydrationBoundary state={dehydrate(queryClient)}>
      {/* 3. –†–µ–Ω–¥–µ—Ä–∏–º–æ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç */}
      <UserList />
    </HydrationBoundary>
  );
}
```

Client Component (app/users/user-list.tsx)

```typescript
'use client';

import { useQuery } from '@tanstack/react-query';
import { getUsers } from '@/actions/getUsers';

export default function UserList() {
  // 4. useQuery –∑—á–∏—Ç—É—î –¥–∞–Ω—ñ –∑ HydrationBoundary –ú–ò–¢–¢–Ñ–í–û.
  // –ó–∞–ø–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ù–ï –ø–æ–ª–µ—Ç–∏—Ç—å (status === 'success' –æ–¥—Ä–∞–∑—É).
  const { data } = useQuery({
    queryKey: ['users'],
    queryFn: () => getUsers(),
  });

  return (
    <div>
      {data?.map((user) => (
        <div key={user.id}>{user.name}</div>
      ))}
    </div>
  );
}
```

–¶–µ –∫–ª–∞—Å–∏—á–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ "Double Fetch" (–ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É) –ø—Ä–∏ SSR. –¢–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–π: –Ω–µ–º–∞—î —Å–µ–Ω—Å—É –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Å–µ—Ä–≤–µ—Ä —â–µ —Ä–∞–∑, —è–∫—â–æ –º–∏ —â–æ–π–Ω–æ –æ—Ç—Ä–∏–º–∞–ª–∏ –¥–∞–Ω—ñ –ø—ñ–¥ —á–∞—Å –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó HTML.

–©–æ–± —Ü—å–æ–≥–æ —É–Ω–∏–∫–Ω—É—Ç–∏, —Ç–∏ **–∑–æ–±–æ–≤'—è–∑–∞–Ω–∏–π** –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ `staleTime`. –¶–µ —î–¥–∏–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å–ø–æ—Å—ñ–± —Å–∫–∞–∑–∞—Ç–∏ React Query: _"–¶—ñ –¥–∞–Ω—ñ, —â–æ –ø—Ä–∏–π—à–ª–∏ –∑ —Å–µ—Ä–≤–µ—Ä–∞, —â–µ —Å–≤—ñ–∂—ñ. –ù–µ —á—ñ–ø–∞–π —ó—Ö –ø–µ–≤–Ω–∏–π —á–∞—Å"_.

–û—Å—å 3 —Å–ø–æ—Å–æ–±–∏, —è–∫ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏, –≤—ñ–¥ –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ.

### –°–ø–æ—Å—ñ–± 1: –õ–æ–∫–∞–ª—å–Ω–∏–π `staleTime` (–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π)

–ü—Ä–æ—Å—Ç–æ –¥–æ–¥–∞–π `staleTime` —É —Å–≤—ñ–π —Ö—É–∫. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, 1 —Ö–≤–∏–ª–∏–Ω–∞.

```typescript
const { data } = useQuery({
  queryKey: ['users'],
  queryFn: () => getUsers(),
  // –í–ê–ñ–õ–ò–í–û: –ö–∞–∂–µ–º–æ: "–í–≤–∞–∂–∞–π –¥–∞–Ω—ñ —Å–≤—ñ–∂–∏–º–∏ 1 —Ö–≤–∏–ª–∏–Ω—É"
  staleTime: 60 * 1000,
});
```

**–©–æ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è:**

1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–∞—É–Ω—Ç–∏—Ç—å—Å—è.
2. React Query –±–∞—á–∏—Ç—å –¥–∞–Ω—ñ –∑ HydrationBoundary.
3. –í—ñ–Ω –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ `staleTime`.
4. –í—ñ–Ω –±–∞—á–∏—Ç—å, —â–æ –¥–∞–Ω—ñ –±—É–ª–∏ –æ—Ç—Ä–∏–º–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ 500–º—Å —Ç–æ–º—É (timestamp –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø—Ä–∏ –≥—ñ–¥—Ä–∞—Ü—ñ—ó).
5. `500ms < 1min` -> **–î–∞–Ω—ñ —Å–≤—ñ–∂—ñ**.
6. **–§–æ–Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç –ù–ï –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è.**

### –°–ø–æ—Å—ñ–± 2: –ì–ª–æ–±–∞–ª—å–Ω–∏–π `staleTime` (Best Practice)

–î–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –¥–æ–¥–∞—Ç–∫—ñ–≤ `staleTime: 0` ‚Äî —Ü–µ –∑–∞–Ω–∞–¥—Ç–æ –∞–≥—Ä–µ—Å–∏–≤–Ω–æ. –ó–∞–∑–≤–∏—á–∞–π, –¥–∞–Ω—ñ –Ω–µ –ø—Ä–æ—Ç—É—Ö–∞—é—Ç—å –º–∏—Ç—Ç—î–≤–æ.
–ö—Ä–∞—â–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 1 —Ö–≤–∏–ª–∏–Ω–∞) –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞.

**–§–∞–π–ª: `providers.tsx` (–∞–±–æ –¥–µ —Ç–∏ —Å—Ç–≤–æ—Ä—é—î—à QueryClient)**

```typescript
const [queryClient] = useState(
  () =>
    new QueryClient({
      defaultOptions: {
        queries: {
          // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤—Å—ñ –∑–∞–ø–∏—Ç–∏ –≤–≤–∞–∂–∞—é—Ç—å—Å—è —Å–≤—ñ–∂–∏–º–∏ 1 —Ö–≤–∏–ª–∏–Ω—É.
          // –¶–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ —Ñ–µ—Ç—á—É –¥–ª—è –≤—Å—å–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É.
          staleTime: 60 * 1000,

          // –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ, —è–∫—â–æ —é–∑–µ—Ä –ø–µ—Ä–µ–º–∫–Ω—É–≤ –≤–∫–ª–∞–¥–∫—É, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ staleTime –Ω–µ –≤–∏–π—à–æ–≤?
          // –ó–∞–∑–≤–∏—á–∞–π –∫—Ä–∞—â–µ false, —è–∫—â–æ staleTime –∞–∫—Ç–∏–≤–Ω–∏–π.
          refetchOnWindowFocus: false,
        },
      },
    }),
);
```

–Ø–∫—â–æ –¥–ª—è —è–∫–æ—ó—Å—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç) —Ç–æ–±—ñ —Ç—Ä–µ–±–∞ –º–∏—Ç—Ç—î–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, —Ç–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∏—à —Ü–µ –ª–æ–∫–∞–ª—å–Ω–æ: `useQuery({ ..., staleTime: 0 })`.

### –°–ø–æ—Å—ñ–± 3: `refetchOnMount: false` (–ñ–æ—Ä—Å—Ç–∫–∏–π –º–µ—Ç–æ–¥)

–Ø–∫—â–æ —Ç–∏ **–ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ** –Ω–µ —Ö–æ—á–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `staleTime` (—Ö–æ—á–∞ —è —Ä–∞–¥–∂—É —Å–∞–º–µ –π–æ–≥–æ), —Ç–∏ –º–æ–∂–µ—à –∑–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ —Ñ–µ—Ç—á –ø—Ä–∏ –º–∞—É–Ω—Ç—ñ.

```typescript
const { data } = useQuery({
  queryKey: ['users'],
  queryFn: () => getUsers(),
  refetchOnMount: false,
});
```

**–ú—ñ–Ω—É—Å —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:**
–Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—ñ–¥–µ –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —ñ –ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–æ–∑–º–æ–Ω—Ç—É—î—Ç—å—Å—è —ñ –∑–º–æ–Ω—Ç—É—î—Ç—å—Å—è –∑–Ω–æ–≤—É), –∑–∞–ø–∏—Ç **–Ω–µ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è**, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –¥–∞–Ω—ñ –≤–∂–µ –¥—É–∂–µ —Å—Ç–∞—Ä—ñ. –í—ñ–Ω –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ç–∏ –Ω–∞—Ç–∏—Å–Ω–µ—à –∫–Ω–æ–ø–∫—É, —è–∫–∞ –≤–∏–∫–ª–∏—á–µ `refetch`, –∞–±–æ —Å–ø—Ä–∞—Ü—é—î —Ñ–æ–∫—É—Å –≤—ñ–∫–Ω–∞ (—è–∫—â–æ –≤—ñ–Ω —É–≤—ñ–º–∫–Ω–µ–Ω–∏–π). –¶–µ —Ä–∏–∑–∏–∫–æ–≤–∞–Ω–æ –¥–ª—è UX.

### –†–µ–∑—é–º–µ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∞

–¢–≤–æ—è –ø—Ä–æ–±–ª–µ–º–∞ –≤–∏—Ä—ñ—à—É—î—Ç—å—Å—è **–æ–¥–Ω–∏–º —Ä—è–¥–∫–æ–º** —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó.

–£ Next.js (SSR) –ø–∞—Ç–µ—Ä–Ω —Ç–∞–∫–∏–π:

1. –ú–∏ —Ä–æ–±–∏–º–æ –∑–∞–ø–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.
2. –ú–∏ —Ö–æ—á–µ–º–æ, —â–æ–± –∫–ª—ñ—î–Ω—Ç –¥–æ–≤—ñ—Ä—è–≤ —Ü—å–æ–º—É –∑–∞–ø–∏—Ç—É –ø–µ–≤–Ω–∏–π —á–∞—Å.
3. –¢–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **`staleTime` > 0** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `5 * 1000` –¥–ª—è 5 —Å–µ–∫—É–Ω–¥ –∞–±–æ `60 * 1000` –¥–ª—è —Ö–≤–∏–ª–∏–Ω–∏) —î **–æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º** –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–æ–¥–≤—ñ–π–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.

–í—Å—Ç–∞–Ω–æ–≤–∏ `staleTime: 60 * 1000`, —ñ "–∑–∞–π–≤–∏–π" –∑–∞–ø–∏—Ç –∑–Ω–∏–∫–Ω–µ.

## useSyncExternalStore

–¶–µ –¥—É–∂–µ –≥–ª–∏–±–æ–∫–µ —ñ –ø—Ä–∞–≤–∏–ª—å–Ω–µ —Ç–µ—Ö–Ω—ñ—á–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è. –î–∞–≤–∞–π —Ä–æ–∑–±–µ—Ä–µ–º–æ—Å—è, —è–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –Ω–∞ —Ä—ñ–≤–Ω—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ React 18+ —Ç–∞ TanStack Query v5.

–ö–æ—Ä–æ—Ç–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: **`useSyncExternalStore` –ù–ï —Ä–æ–±–∏—Ç—å —Ñ–µ—Ç—á.**
–§–µ—Ç—á –≤—Å–µ –æ–¥–Ω–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —è–∫ **Side Effect (–ü–æ–±—ñ—á–Ω–∏–π –µ—Ñ–µ–∫—Ç)**, —Ç–æ–±—Ç–æ —Ç–µ—Ö–Ω—ñ—á–Ω–æ —Ü–µ –∞–Ω–∞–ª–æ–≥ `useEffect`.

–û—Å—å —á–æ–º—É —ñ —è–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:

### 1. –†–æ–∑–ø–æ–¥—ñ–ª –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ

–£ React —î —Å—É–≤–æ—Ä–µ –ø—Ä–∞–≤–∏–ª–æ: **–ü—ñ–¥ —á–∞—Å —Ä–µ–Ω–¥–µ—Ä—É (Render Phase) –Ω–µ –º–æ–∂–Ω–∞ —Ä–æ–±–∏—Ç–∏ Side Effects (HTTP-–∑–∞–ø–∏—Ç–∏).**
`useSyncExternalStore` ‚Äî —Ü–µ —Ö—É–∫, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –ø—ñ–¥ —á–∞—Å —Ä–µ–Ω–¥–µ—Ä—É —Ç–∞ –∫–æ–º—ñ—Ç—É, –∞–ª–µ –π–æ–≥–æ –≥–æ–ª–æ–≤–Ω–∞ –º–µ—Ç–∞ ‚Äî **–ø—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –∑–º—ñ–Ω–∏** —É –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É —Å—Ö–æ–≤–∏—â—ñ (Store) —ñ –≥–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏, —â–æ UI –Ω–µ "—Ä–æ–∑—ñ—Ä–≤–µ—Ç—å—Å—è" (Tearing) –ø—ñ–¥ —á–∞—Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É.

–¢–æ–º—É —Ä–æ–ª—ñ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ —Ç–∞–∫:

1. **`useSyncExternalStore`**: –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ **–ß–ò–¢–ê–ù–ù–Ø**. –í—ñ–Ω –∫–∞–∂–µ: _"–°–ª—ñ–¥–∫—É–π –∑–∞ —Ü–∏–º —à–º–∞—Ç–∫–æ–º –∫–µ—à—É. –Ø–∫—â–æ –≤—ñ–Ω –∑–º—ñ–Ω–∏—Ç—å—Å—è ‚Äî –ø–µ—Ä–µ–º–∞–ª—é–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç"_ .
2. **`QueryObserver` (–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –∫–ª–∞—Å)**: –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ **–õ–û–ì–Ü–ö–£**. –í—ñ–Ω –≤–∏—Ä—ñ—à—É—î, —á–∏ –¥–∞–Ω—ñ "–ø—Ä–æ—Ç—É—Ö–ª–∏" —ñ —á–∏ —Ç—Ä–µ–±–∞ —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç.
3. **–ï—Ñ–µ–∫—Ç (Internal Effect)**: –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ **–ó–ê–ü–ò–¢**.

### 2. –Ø–∫ —Å–∞–º–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è Fetch?

–ö–æ–ª–∏ —Ç–∏ –ø–∏—à–µ—à `useQuery`, –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—Ä–∏–±–ª–∏–∑–Ω–æ —Ç–∞–∫–∏–π –ø—Ä–æ—Ü–µ—Å (—Å–ø—Ä–æ—â–µ–Ω–æ):

1. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è (Render):** –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —ñ–Ω—Å—Ç–∞–Ω—Å `QueryObserver`.
2. **–ü—ñ–¥–ø–∏—Å–∫–∞ (Commit):** React –≤–∏–∫–ª–∏–∫–∞—î `useSyncExternalStore`. –¶–µ–π —Ö—É–∫ —Ä–µ—î—Å—Ç—Ä—É—î `Observer` —É `QueryClient`.
3. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ (Mount):** –Ø–∫ —Ç—ñ–ª—å–∫–∏ –ø—ñ–¥–ø–∏—Å–∫–∞ –≤—ñ–¥–±—É–ª–∞—Å—è (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–º–æ–Ω—Ç—É–≤–∞–≤—Å—è), `Observer` –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç–∞–Ω: _"–û–π, —É –Ω–∞—Å –Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö (–∞–±–æ –≤–æ–Ω–∏ stale)"_.
4. **–í–∏–∫–ª–∏–∫ (Fetch):** `Observer` –∑–∞–ø—É—Å–∫–∞—î –º–µ—Ç–æ–¥ `fetch()`.

–¶–µ–π –∑–∞–ø—É—Å–∫ `fetch()` –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –∞–±–æ –≤ –º—ñ–∫—Ä–æ—Ç–∞—Å—Ü—ñ, —â–æ –¥–ª—è React —î –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–æ–º —Ä–æ–±–æ—Ç–∏ –≤ `useEffect`.

### 3. –ß–æ–º—É –Ω–µ —Ä–æ–±–∏—Ç–∏ —Ñ–µ—Ç—á –ø—Ä—è–º–æ –≤ `useSyncExternalStore`?

–Ø–∫—â–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑—Ä–æ–±–∏—Ç–∏ —Ñ–µ—Ç—á –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `getSnapshot` (—è–∫—É –ø—Ä–∏–π–º–∞—î `useSyncExternalStore`), —Ü–µ –∑–ª–∞–º–∞—î React, –±–æ —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –º–∞—î –±—É—Ç–∏ —á–∏—Å—Ç–æ—é (pure) —ñ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –º–∏—Ç—Ç—î–≤–æ.

–ê —è–∫—â–æ —Ä–æ–±–∏—Ç–∏ —Ü–µ –≤ `subscribe` (—Ñ—É–Ω–∫—Ü—ñ—è –ø—ñ–¥–ø–∏—Å–∫–∏), —Ç–æ —Ü–µ —è–∫—Ä–∞–∑ —ñ —î –º–æ–º–µ–Ω—Ç, –∫–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–∂–µ –∑–∞–º–∞—É–Ω—Ç–∏–≤—Å—è (–∞–±–æ –∑–∞–∫–æ–º—ñ—Ç–∏–≤—Å—è). –¢–æ–±—Ç–æ, **—Ñ—É–Ω–∫—Ü—ñ—è `subscribe` –≤ `useSyncExternalStore` —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –≤ —Ç–æ–π —Å–∞–º–∏–π —á–∞—Å, –∫–æ–ª–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î `useEffect**`(–∞–±–æ`useLayoutEffect`).

### –ü—Å–µ–≤–¥–æ–∫–æ–¥ —Ç–æ–≥–æ, —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏

–û—Å—å —è–∫ —Ü–µ –≤–∏–≥–ª—è–¥–∞—î –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ TanStack Query:

```typescript
function useQuery(options) {
  // 1. –°—Ç–≤–æ—Ä—é—î–º–æ "–º–æ–∑–æ–∫", —è–∫–∏–π –∫–µ—Ä—É—î –ª–æ–≥—ñ–∫–æ—é
  const [observer] = useState(() => new QueryObserver(client, options));

  // 2. –ü—ñ–¥–ø–∏—Å—É—î–º–æ—Å—å –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ—Ä—É (—â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ data, isLoading)
  // useSyncExternalStore –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π state
  const result = useSyncExternalStore(
    (onStoreChange) => {
      // –¶—è —Ñ—É–Ω–∫—Ü—ñ—è subscribe –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∫–æ–º—ñ—Ç—É (—è–∫ useEffect)
      const unsubscribe = observer.subscribe(onStoreChange);

      // ‚ö°Ô∏è –û–°–¨ –¢–£–¢ –ú–ê–ì–Ü–Ø:
      // –ü—ñ—Å–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏ Observer –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —Ç—Ä–µ–±–∞ —Ñ–µ—Ç—á–∏—Ç–∏.
      // –Ø–∫—â–æ —Ç–∞–∫ ‚Äî –≤—ñ–Ω –∑–∞–ø—É—Å–∫–∞—î –∑–∞–ø–∏—Ç.
      observer.updateResult();

      return unsubscribe;
    },
    () => observer.getCurrentResult(),
  );

  return result;
}
```

### –í–∏—Å–Ω–æ–≤–æ–∫

–¢–∏ –ø—Ä–∞–≤–∏–π, —â–æ `useQuery` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `useSyncExternalStore` –¥–ª—è **–∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω–æ–º** (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∑–∞–π–≤–∏—Ö —Ä–µ—Ä–µ–Ω–¥–µ—Ä—ñ–≤ —ñ –ø—Ä–æ–±–ª–µ–º React 18).

–ê–ª–µ **—Å–∞–º HTTP-–∑–∞–ø–∏—Ç (fetch)** —ñ–Ω—ñ—Ü—ñ—é—î—Ç—å—Å—è –ª–æ–≥—ñ–∫–æ—é `Observer`-–∞, —è–∫–∞ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –≤ –º–æ–º–µ–Ω—Ç –ø—ñ–¥–ø–∏—Å–∫–∏. –ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É React, —Ü–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è **–≤ —Ç–æ–π —Å–∞–º–∏–π –º–æ–º–µ–Ω—Ç, –¥–µ –ø—Ä–∞—Ü—é–≤–∞–≤ –±–∏ `useEffect**`.

–¢–æ–±—Ç–æ:

- **–ú–µ—Ö–∞–Ω—ñ–∑–º –ø—ñ–¥–ø–∏—Å–∫–∏:** `useSyncExternalStore`.
- **–ú–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫—É —Ñ–µ—Ç—á—É:** Side Effect (–ø—ñ—Å–ª—è –º–∞—É–Ω—Ç—É).

–ì–æ–ª–æ–≤–Ω–∏–π —Å–µ–∫—Ä–µ—Ç –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ **—Ç–∏ —Å–∞–º –Ω–µ —Å–ø–æ–≤—ñ—â–∞—î—à —Ö—É–∫ –Ω–∞–ø—Ä—è–º—É**.

–ö–æ–ª–∏ React –≤–∏–∫–ª–∏–∫–∞—î —Ç–≤–æ—é —Ñ—É–Ω–∫—Ü—ñ—é `subscribe`, –≤—ñ–Ω –ø–µ—Ä–µ–¥–∞—î —Ç–æ–±—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—É **callback-—Ñ—É–Ω–∫—Ü—ñ—é** (–∑–∞–∑–≤–∏—á–∞–π —ó—ó –Ω–∞–∑–∏–≤–∞—é—Ç—å `onStoreChange` –∞–±–æ `notify`). –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî **–∑–±–µ—Ä–µ–≥—Ç–∏ —Ü–µ–π callback** —ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –π–æ–≥–æ, –∫–æ–ª–∏ –¥–∞–Ω—ñ –∑–º—ñ–Ω—è—Ç—å—Å—è.

–û—Å—å –º–µ—Ö–∞–Ω—ñ–∫–∞ "–Ω–∞ –ø–∞–ª—å—Ü—è—Ö":

1. **React:** "–ü—Ä–∏–≤—ñ—Ç, —è —Ö–æ—á—É –ø—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è. –û—Å—å –º–æ—è —Ñ—É–Ω–∫—Ü—ñ—è `callback`. –°–º–∏–∫–Ω–∏ —ó—ó, –∫–æ–ª–∏ —â–æ—Å—å –∑–º—ñ–Ω–∏—Ç—å—Å—è."
2. **–¢–≤—ñ–π Store:** "–û–∫, —è –ø–æ–∫–ª–∞–≤ —Ü–µ–π `callback` —É –º–∞—Å–∏–≤ `listeners`."
3. **–ó–º—ñ–Ω–∞ –¥–∞–Ω–∏—Ö:** –¢–∏ –æ–Ω–æ–≤–ª—é—î—à `state`.
4. **–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è:** –¢–≤—ñ–π Store –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–æ –º–∞—Å–∏–≤—É `listeners` —ñ –≤–∏–∫–ª–∏–∫–∞—î –∫–æ–∂–µ–Ω `callback()`.
5. **–†–µ–∞–∫—Ü—ñ—è:** React —á—É—î –≤–∏–∫–ª–∏–∫, –∑–∞–ø—É—Å–∫–∞—î `getSnapshot`, –±–∞—á–∏—Ç—å –Ω–æ–≤—ñ –¥–∞–Ω—ñ —ñ —Ä–æ–±–∏—Ç—å —Ä–µ—Ä–µ–Ω–¥–µ—Ä.

### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è (Pattern Observer)

–©–æ–± —Ü–µ –∑–∞–ø—Ä–∞—Ü—é–≤–∞–ª–æ, —Ç–æ–±—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç–∏–π –ø–∞—Ç–µ—Ä–Ω "–°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á" (Observer).

–û—Å—å –ø–æ–≤–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ "Store" –∑ –Ω—É–ª—è:

```typescript
// 1. –°—Ç–≤–æ—Ä—é—î–º–æ –∑–æ–≤–Ω—ñ—à–Ω—î —Å—Ö–æ–≤–∏—â–µ (Store)
const myStore = {
  state: { count: 0 },
  listeners: new Set<() => void>(), // –¢—É—Ç –±—É–¥—É—Ç—å –∂–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó React-–∞

  // –ú–µ—Ç–æ–¥ —á–∏—Ç–∞–Ω–Ω—è (getSnapshot)
  getState() {
    return myStore.state;
  },

  // –ú–µ—Ç–æ–¥ –ø—ñ–¥–ø–∏—Å–∫–∏ (subscribe)
  subscribe(callback: () => void) {
    // 1. React –¥–∞—î –Ω–∞–º callback, –º–∏ –π–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ
    myStore.listeners.add(callback);

    // 2. –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –≤—ñ–¥–ø–∏—Å–∫–∏ (cleanup)
    return () => myStore.listeners.delete(callback);
  },

  // –ú–µ—Ç–æ–¥ –∑–º—ñ–Ω–∏ –¥–∞–Ω–∏—Ö (Action)
  increment() {
    // –í–∞–∂–ª–∏–≤–æ: –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç (Immutability), —â–æ–± React –ø–æ–±–∞—á–∏–≤ —Ä—ñ–∑–Ω–∏—Ü—é
    myStore.state = { count: myStore.state.count + 1 };

    // ‚ö°Ô∏è –û–°–¨ –¢–£–¢ –ú–ò –°–ü–û–í–Ü–©–ê–Ñ–ú–û REACT
    myStore.emitChange();
  },

  emitChange() {
    // –ü—Ä–æ—Å—Ç–æ –≤–∏–∫–ª–∏–∫–∞—î–º–æ –≤—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
    myStore.listeners.forEach((listener) => listener());
  },
};
```

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ

```tsx
import { useSyncExternalStore } from 'react';

export default function Counter() {
  // Hook —Å–∞–º –ø–µ—Ä–µ–¥–∞—Å—Ç—å —Å–≤—ñ–π –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π callback —É myStore.subscribe
  const state = useSyncExternalStore(myStore.subscribe, myStore.getState);

  return <button onClick={() => myStore.increment()}>Count: {state.count}</button>;
}
```

### –ö—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤—ñ –Ω—é–∞–Ω—Å–∏

1. **Immutability (–ù–µ–∑–º—ñ–Ω–Ω—ñ—Å—Ç—å):**
   `useSyncExternalStore` –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∑–º—ñ–Ω–∏ —á–µ—Ä–µ–∑ `Object.is` (—Å—É–≤–æ—Ä–∞ —Ä—ñ–≤–Ω—ñ—Å—Ç—å).
   –Ø–∫—â–æ —Ç–∏ –∑—Ä–æ–±–∏—à —Ç–∞–∫:

```javascript
// ‚ùå –ü–æ–º–∏–ª–∫–∞: –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±'—î–∫—Ç –Ω–µ –∑–º—ñ–Ω–∏–ª–æ—Å—è
myStore.state.count++;
myStore.emitChange();
```

React –≤–∏–∫–ª–∏—á–µ `getSnapshot`, –æ—Ç—Ä–∏–º–∞—î _—Ç–æ–π —Å–∞–º–∏–π –æ–±'—î–∫—Ç_, –ø–æ—Ä—ñ–≤–Ω—è—î –π–æ–≥–æ –∑—ñ —Å—Ç–∞—Ä–∏–º, –ø–æ–±–∞—á–∏—Ç—å `true` —ñ **–Ω–µ –æ–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Ç–∏ –≤–∏–∫–ª–∏–∫–∞–≤ –ª—ñ—Å–µ–Ω–µ—Ä–∏.
–¢–∏ –º—É—Å–∏—à –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ **–Ω–æ–≤–∏–π –æ–±'—î–∫—Ç** –∞–±–æ –ø—Ä–∏–º—ñ—Ç–∏–≤. 2. **–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å —Ñ—É–Ω–∫—Ü—ñ–π:**
–§—É–Ω–∫—Ü—ñ—ó `subscribe` —Ç–∞ `getState` –º–∞—é—Ç—å –±—É—Ç–∏ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–º–∏ (–Ω–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É —Ä–µ–Ω–¥–µ—Ä—ñ), —ñ–Ω–∞–∫—à–µ —Ç–∏ –ø–æ—Ç—Ä–∞–ø–∏—à —É –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π —Ü–∏–∫–ª –ø–µ—Ä–µ–ø—ñ–¥–ø–∏—Å–æ–∫. –¢–æ–º—É –º–∏ –≤–∏–Ω–µ—Å–ª–∏ `myStore` –∑–∞ –º–µ–∂—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ React Query / Redux?

–í–æ–Ω–∏ —Ä–æ–±–ª—è—Ç—å —Ç–µ —Å–∞–º–µ, —Ç—ñ–ª—å–∫–∏ —ó—Ö–Ω—ñ–π `state` –Ω–∞–±–∞–≥–∞—Ç–æ —Å–∫–ª–∞–¥–Ω—ñ—à–∏–π, –∞ `listeners` —á–∞—Å—Ç–æ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–∫–ª–∏–∫–∞—é—Ç—å—Å—è –±–∞—Ç—á–∞–º–∏, —â–æ–± –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç–∏ –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ).

–ê–ª–µ —Å—É—Ç—å –æ–¥–Ω–∞: **React –¥–∞—î —Ç–æ–±—ñ "–ø—É–ª—å—Ç" (callback), –∞ —Ç–∏ –Ω–∞—Ç–∏—Å–∫–∞—î—à –Ω–∞ –∫–Ω–æ–ø–∫—É, –∫–æ–ª–∏ –≥–æ—Ç–æ–≤–∏–π.**

## –í–∏–º–∫–Ω—É—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è

–©–æ–± –ø–æ–≤–Ω—ñ—Å—Ç—é **–≤–∏–º–∫–Ω—É—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è** –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É –≤ TanStack Query (v5), —Ç–æ–±—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏: `gcTime` (—á–∞—Å –∂–∏—Ç—Ç—è –≤ –ø–∞–º'—è—Ç—ñ) —Ç–∞ `staleTime` (—á–∞—Å —Å–≤—ñ–∂–æ—Å—Ç—ñ).

–û—Å—å "–∑–æ–ª–æ—Ç–∞ —Ñ–æ—Ä–º—É–ª–∞" –¥–ª—è —Ä–µ–∂–∏–º—É **No Cache**:

```typescript
const { data } = useQuery({
  queryKey: ['secure-data'],
  queryFn: () => apiService.get('/secure/data'),

  // 1. –ù–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–∞–Ω—ñ –≤ –ø–∞–º'—è—Ç—ñ –Ω—ñ –Ω–∞ —Å–µ–∫—É–Ω–¥—É –ø—ñ—Å–ª—è —Ä–æ–∑–º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è
  gcTime: 0, // (–≤ v4 —Ü–µ –Ω–∞–∑–∏–≤–∞–ª–æ—Å—å cacheTime)

  // 2. –í–≤–∞–∂–∞—Ç–∏ –¥–∞–Ω—ñ —Å—Ç–∞—Ä–∏–º–∏ –º–∏—Ç—Ç—î–≤–æ (—â–æ–± –∑–∞–≤–∂–¥–∏ —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç –ø—Ä–∏ –º–∞—É–Ω—Ç—ñ)
  staleTime: 0,

  // 3. (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –ù–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ –ø—ñ–¥ —á–∞—Å –Ω–æ–≤–æ–≥–æ –∑–∞–ø–∏—Ç—É, —è–∫—â–æ –≤–æ–Ω–∏ —è–∫–∏–º–æ—Å—å –¥–∏–≤–æ–º —Ç–∞–º —î
  refetchOnMount: 'always',
});
```

### –†–æ–∑–±—ñ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:

1. **`gcTime: 0` (Garbage Collection Time)** ‚Äî –¶–µ –≥–æ–ª–æ–≤–Ω–∏–π "–≤–∏–º–∏–∫–∞—á".

- **–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (5 —Ö–≤):** –ö–æ–ª–∏ —Ç–∏ –π–¥–µ—à –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –¥–∞–Ω—ñ –ª–µ–∂–∞—Ç—å —É –ø–∞–º'—è—Ç—ñ ("—Ö–æ–ª–æ–¥–Ω–æ–º—É –∫–µ—à—ñ") 5 —Ö–≤–∏–ª–∏–Ω. –Ø–∫—â–æ –ø–æ–≤–µ—Ä–Ω–µ—à—Å—è ‚Äî –≤–æ–Ω–∏ –ø–æ–∫–∞–∂—É—Ç—å—Å—è –º–∏—Ç—Ç—î–≤–æ.
- **`0`:** –Ø–∫ —Ç—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü–µ–π –∑–∞–ø–∏—Ç, —Ä–æ–∑–º–æ–Ω—Ç—É—î—Ç—å—Å—è (unmount), React Query **–º–∏—Ç—Ç—î–≤–æ –≤–∏–¥–∞–ª—è—î** —Ü—ñ –¥–∞–Ω—ñ –∑ –ø–∞–º'—è—Ç—ñ. –Ø–∫—â–æ —é–∑–µ—Ä –ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è —á–µ—Ä–µ–∑ 1 –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥—É ‚Äî –∑–∞–ø–∏—Ç –ø—ñ–¥–µ –∑ –Ω—É–ª—è, —ñ –±—É–¥–µ `isLoading: true`.

2. **`staleTime: 0`**

- –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –¥–∞–Ω—ñ –∑–∞–≤–∂–¥–∏ –≤–≤–∞–∂–∞—é—Ç—å—Å—è "–ø—Ä–æ—Ç—É—Ö–ª–∏–º–∏", —ñ React Query –Ω–∞–º–∞–≥–∞—Ç–∏–º–µ—Ç—å—Å—è –æ–Ω–æ–≤–∏—Ç–∏ —ó—Ö –ø—Ä–∏ –±—É–¥—å-—è–∫—ñ–π –Ω–∞–≥–æ–¥—ñ (—Ñ–æ–∫—É—Å –≤—ñ–∫–Ω–∞, –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–µ—Ä–µ–∂—ñ —Ç–æ—â–æ).

---

### –ö–æ–ª–∏ —Ü–µ —Ä–µ–∞–ª—å–Ω–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ (Use Cases)?

–í 99% –≤–∏–ø–∞–¥–∫—ñ–≤ –≤–∏–º–∏–∫–∞—Ç–∏ –∫–µ—à ‚Äî —Ü–µ –ø–æ–≥–∞–Ω–∞ —ñ–¥–µ—è, –±–æ —Ç–∏ –≤—Ç—Ä–∞—á–∞—î—à —à–≤–∏–¥–∫—ñ—Å—Ç—å UI. –ê–ª–µ —î –≤–∏–Ω—è—Ç–∫–∏:

1. **–°—É–ø–µ—Ä-—Å–µ–∫—Ä–µ—Ç–Ω—ñ –¥–∞–Ω—ñ:** –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è –æ–ø–ª–∞—Ç–∏ –∞–±–æ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—é—á, —è–∫–∏–π –Ω–µ –º–æ–∂–Ω–∞ —Ç—Ä–∏–º–∞—Ç–∏ –≤ –ø–∞–º'—è—Ç—ñ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–≤—à–µ, –Ω—ñ–∂ —Ç—Ä–µ–±–∞.
2. **–î—É–∂–µ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –¥–∞–Ω—ñ:** –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–∞—Ç—É—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó, —è–∫–∏–π –∑–º—ñ–Ω—é—î—Ç—å—Å—è —â–æ—Å–µ–∫—É–Ω–¥–∏, —ñ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Å—Ç–∞—Ä–∏–π —Å—Ç–∞—Ç—É—Å ("Pending") –Ω–∞–≤—ñ—Ç—å –Ω–∞ –º–∏—Ç—å ‚Äî –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ.
3. **Debugging:** –ö–æ–ª–∏ —Ç–∏ –¥–µ–±–∞–∂–∏—à –±–µ–∫–µ–Ω–¥ —ñ —Ç–µ–±–µ –¥—Ä–∞—Ç—É—î, —â–æ —Ñ—Ä–æ–Ω—Ç –Ω–µ —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç.

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ü—Ä–æ—Å—Ç–æ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `useQuery`

–Ø–∫—â–æ —Ç–æ–±—ñ –≤–∑–∞–≥–∞–ª—ñ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Ñ—ñ—à–∫–∏ React Query (—Å—Ç–∞–Ω–∏, –¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è, —Ä–µ—Ç—Ä–∞—ó) –¥–ª—è —Ü—å–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É, –º–æ–∂–ª–∏–≤–æ, —Ç–æ–±—ñ –ø—Ä–æ—Å—Ç—ñ—à–µ –∑—Ä–æ–±–∏—Ç–∏ –ø–æ-—Å—Ç–∞—Ä–æ–º—É:

```typescript
// –Ü–Ω–æ–¥—ñ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ —Ä—ñ—à–µ–Ω–Ω—è - –Ω–∞–π–∫—Ä–∞—â–µ
useEffect(() => {
  apiService.get('/data').then(setData);
}, []);
```

–ê–ª–µ —è–∫—â–æ —Ç–∏ —Ö–æ—á–µ—à –∑–±–µ—Ä–µ–≥—Ç–∏ API (loading, error states) –≤—ñ–¥ React Query, —Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é `gcTime: 0` + `staleTime: 0`.

## –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞–Ω –¥–∞–Ω–Ω–∏—Ö (from cache/fetching)

–¶–µ —Å—É–ø–µ—Ä –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è UX. React Query (TanStack Query) –¥–∞—î —Ç–æ–±—ñ –ø–æ–≤–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä—ñ–π –¥–ª—è —Ü—å–æ–≥–æ —á–µ—Ä–µ–∑ **–¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü—ñ—é –æ–±'—î–∫—Ç–∞**, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î `useQuery`.

–¢–æ–±—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ 3 –∫–ª—é—á–æ–≤—ñ –ø—Ä–∞–ø–æ—Ä—Ü—ñ: `isFetching`, `isStale` —Ç–∞ `dataUpdatedAt`.

–î–∞–≤–∞–π —Ä–æ–∑–±–µ—Ä–µ–º–æ —Å—Ü–µ–Ω–∞—Ä—ñ—ó.

---

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: "–î–∞–Ω—ñ —î, –∞–ª–µ –º–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —ó—Ö –∞–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å" (Background Refetch)

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Å–ø–∏—Å–æ–∫, –∞–ª–µ —Ç–∏ —Ö–æ—á–µ—à –ø–æ–∫–∞–∑–∞—Ç–∏ –º–∞–ª–µ–Ω—å–∫–∏–π —Å–ø—ñ–Ω–µ—Ä –¥–µ—Å—å —É –∫—É—Ç–∫—É, —â–æ –π–¥–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.

–î–ª—è —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π **`isFetching`**.

> **–í–∞–∂–ª–∏–≤–æ:** –ù–µ –ø–ª—É—Ç–∞–π –∑ `isLoading` (–∞–±–æ `isPending` —É v5).
>
> - `isPending`: –î–∞–Ω–∏—Ö **–ù–ï–ú–ê–Ñ** –≤–∑–∞–≥–∞–ª—ñ (–ø–µ—Ä—à–∏–π –∑–∞–ø—É—Å–∫).
> - `isFetching`: –ó–∞–ø–∏—Ç –ª–µ—Ç–∏—Ç—å –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑ (–Ω–µ–≤–∞–∂–ª–∏–≤–æ, —î –¥–∞–Ω—ñ —á–∏ –Ω—ñ).

```tsx
const { data, isFetching } = useQuery({ queryKey: ['users'], queryFn: getUsers });

return (
  <div style={{ opacity: isFetching ? 0.7 : 1 }}>
    <h1>
      –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
      {/* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è */}
      {isFetching && <span className="spinner">üîÑ –û–Ω–æ–≤–ª—é—î–º–æ...</span>}
    </h1>

    {data?.map((user) => (
      <div key={user.id}>{user.name}</div>
    ))}
  </div>
);
```

---

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: "–¶–µ –¥–∞–Ω—ñ –∑ –∫–µ—à—É" (Stale Data)

–¢–∏ —Ö–æ—á–µ—à —è–≤–Ω–æ –ø–æ–∫–∞–∑–∞—Ç–∏ —é–∑–µ—Ä—É: _"–¶—ñ –¥–∞–Ω—ñ –≤–∑—è—Ç—ñ –∑ –ø–∞–º'—è—Ç—ñ, –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Å—Ç–∞—Ä–∏–º–∏"_.

–î–ª—è —Ü—å–æ–≥–æ —î –ø—Ä–∞–ø–æ—Ä–µ—Ü—å **`isStale`**.
–í—ñ–Ω —Å—Ç–∞—î `true`, —è–∫ —Ç—ñ–ª—å–∫–∏ —á–∞—Å `staleTime` –≤–∏—á–µ—Ä–ø–∞–Ω–æ.

```tsx
const { data, isStale } = useQuery({
  queryKey: ['users'],
  queryFn: getUsers,
  staleTime: 1000 * 60 * 5, // 5 —Ö–≤–∏–ª–∏–Ω –¥–∞–Ω—ñ –≤–≤–∞–∂–∞—é—Ç—å—Å—è "—Å–≤—ñ–∂–∏–º–∏"
});

return (
  <div>
    {/* –Ø–∫—â–æ –¥–∞–Ω—ñ –∑ –∫–µ—à—É —ñ —á–∞—Å —Å–≤—ñ–∂–æ—Å—Ç—ñ –≤–∏–π—à–æ–≤ */}
    {isStale && <div className="badge-yellow">‚ö†Ô∏è –î–∞–Ω—ñ –∑ –∞—Ä—Ö—ñ–≤—É</div>}

    {/* –Ø–∫—â–æ –¥–∞–Ω—ñ –∑ –∫–µ—à—É, –∞–ª–µ —â–µ —Å–≤—ñ–∂—ñ (—Ç–∞–π–º–µ—Ä 5 —Ö–≤ –Ω–µ –≤–∏–π—à–æ–≤) */}
    {!isStale && <div className="badge-green">‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ</div>}

    <UserList data={data} />
  </div>
);
```

**–ù—é–∞–Ω—Å:** –Ø–∫—â–æ —Ç–∏ –Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–≤ `staleTime` (–≤—ñ–Ω –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `0`), —Ç–æ `isStale` –±—É–¥–µ **–∑–∞–≤–∂–¥–∏ true** –≤—ñ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö. –¢–æ–º—É —Ü–µ–π –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –∫–æ—Ä–∏—Å–Ω–∏–π —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à `staleTime`.

---

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: "–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: 5 —Ö–≤ —Ç–æ–º—É" (Best Practice)

–ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –ø–∏—Å–∞—Ç–∏ "–¶–µ –∫–µ—à", –∫—Ä–∞—â–µ –ø–æ–∫–∞–∑–∞—Ç–∏ **—á–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —É—Å–ø—ñ—à–Ω–æ–≥–æ —Ñ–µ—Ç—á—É**. –¶–µ –Ω–∞–π–±—ñ–ª—å—à —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ –¥–ª—è —é–∑–µ—Ä–∞.

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø–æ–ª–µ **`dataUpdatedAt`**. –¶–µ timestamp (—á–∏—Å–ª–æ).

```tsx
const { data, dataUpdatedAt } = useQuery({ queryKey: ['users'], queryFn: getUsers });

return (
  <div>
    <header>
      <h1>–ú—ñ–π –î–∞—à–±–æ—Ä–¥</h1>
      <small>–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: {new Date(dataUpdatedAt).toLocaleTimeString()}</small>
    </header>

    <DataView data={data} />
  </div>
);
```

---

### –°—Ü–µ–Ω–∞—Ä—ñ–π 4: PWA / –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –º–µ—Ä–µ–∂—ñ

–£ v4/v5 –∑'—è–≤–∏–≤—Å—è —â–µ –æ–¥–∏–Ω –∫—Ä—É—Ç–∏–π —Å—Ç–∞–Ω ‚Äî **`fetchStatus`**.
–í—ñ–Ω –º–æ–∂–µ –±—É—Ç–∏: `'fetching'`, `'paused'`, `'idle'`.

–¶–µ —ñ–¥–µ–∞–ª—å–Ω–æ –¥–ª—è PWA, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏: _"–ú–∏ —Ö–æ—á–µ–º–æ –æ–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ, –∞–ª–µ –Ω–µ–º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É"_.

```tsx
const { fetchStatus, isPaused } = useQuery({ ... });

// isPaused - —Ü–µ —à–æ—Ä—Ç–∫–∞—Ç –¥–ª—è fetchStatus === 'paused'

if (isPaused) {
  return <div className="warning">üì° –ß–µ–∫–∞—î–º–æ –Ω–∞ –º–µ—Ä–µ–∂—É –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è...</div>;
}

```

---

### –ü—ñ–¥—Å—É–º–æ–∫: –®–ø–∞—Ä–≥–∞–ª–∫–∞ —Å—Ç–∞–Ω—ñ–≤

| –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è?       | `isPending` | `isFetching` | `isStale` | –©–æ –±–∞—á–∏—Ç—å —é–∑–µ—Ä?              |
| ---------------------- | ----------- | ------------ | --------- | ---------------------------- |
| **–ü–µ—Ä—à–∏–π –≤—Ö—ñ–¥**        | ‚úÖ          | ‚úÖ           | ‚úÖ        | –°–∫–µ–ª–µ—Ç–æ–Ω / –í–µ–ª–∏–∫–∏–π —Å–ø—ñ–Ω–µ—Ä    |
| **–£—Å–ø—ñ—Ö (–¥–∞–Ω—ñ —Å–≤—ñ–∂—ñ)** | ‚ùå          | ‚ùå           | ‚ùå        | –î–∞–Ω—ñ + –ë–µ–π–¥–∂ "–°–≤—ñ–∂–µ"         |
| **–§–æ–Ω–æ–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**   | ‚ùå          | ‚úÖ           | ‚úÖ        | –î–∞–Ω—ñ + –ú–∞–ª–µ–Ω—å–∫–∏–π —Å–ø—ñ–Ω–µ—Ä      |
| **–î–∞–Ω—ñ –ø—Ä–æ—Ç—É—Ö–ª–∏**      | ‚ùå          | ‚ùå           | ‚úÖ        | –î–∞–Ω—ñ + –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "–ó –∫–µ—à—É" |
| **–ù–µ–º–∞—î –º–µ—Ä–µ–∂—ñ**       | ‚ùå          | ‚ùå (Paused)  | ‚úÖ        | –î–∞–Ω—ñ + "–í–∏ –æ—Ñ–ª–∞–π–Ω"           |

**–ú–æ—è –ø–æ—Ä–∞–¥–∞:**
–ù–∞–π—á–∞—Å—Ç—ñ—à–µ —Ç–æ–±—ñ –≤–∏—Å—Ç–∞—á–∏—Ç—å –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó `opacity: isFetching ? 0.5 : 1` (—â–æ–± —Ç—Ä–æ—Ö–∏ "–ø—Ä–∏–≥–ª—É—à–∏—Ç–∏" UI –ø—ñ–¥ —á–∞—Å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è) –∞–±–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ù–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂—É–π —é–∑–µ—Ä–∞ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ "–∫–µ—à", —è–∫—â–æ —Ü–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ (—è–∫ –≤ –±–∞–Ω–∫—ñ–≤—Å—å–∫–∏—Ö –∞–ø–ø–∫–∞—Ö).
